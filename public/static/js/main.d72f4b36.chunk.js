(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{121:function(e,t,n){},128:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(27),c=n.n(r),o=n(149),i=n(26),l=n(17),u=n(8),j=n(92),d=n(31),b=n(62),O=n(129),m=n(120),g=n(83),x=n(84),p=n(33),h=n(2),f=Object(j.a)({uri:"/graphql/"});f=Object(g.a)((function(e,t){var n=t.headers,a=localStorage.getItem("token");return{headers:Object(u.a)(Object(u.a)({},n),{},{authorization:a?"Bearer ".concat(a):""})}})).concat(f);var v=window.location.host,w=new x.a({uri:"ws://".concat(v,"/graphql/"),options:{reconnect:!0,connectionParams:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}}),y=Object(d.split)((function(e){var t=e.query,n=Object(p.e)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),w,f),S=new b.a({link:y,cache:new O.a});function N(e){return Object(h.jsx)(m.a,Object(u.a)({client:S},e))}n(121);var E=n(22),C=n(148),k=n(153),L=n(36),M=n(156),$=n(18),A=n(87),D=Object(a.createContext)(),P=Object(a.createContext)(),U=null,I=localStorage.getItem("token");if(I){var R=Object(A.a)(I),T=new Date(1e3*R.exp);new Date>T?localStorage.removeItem("token"):U=R}else console.log("No token found");var G,_=function(e,t){switch(t.type){case"LOGIN":return localStorage.setItem("token",t.payload.token),Object(u.a)(Object(u.a)({},e),{},{user:t.payload});case"LOGOUT":return localStorage.removeItem("token"),Object(u.a)(Object(u.a)({},e),{},{user:null});default:throw new Error("Unknown action type: ".concat(t.type))}},q=function(e){var t=e.children,n=Object(a.useReducer)(_,{user:U}),s=Object($.a)(n,2),r=s[0],c=s[1];return Object(h.jsx)(P.Provider,{value:c,children:Object(h.jsx)(D.Provider,{value:r,children:t})})},Y=function(){return Object(a.useContext)(D)},Q=function(){return Object(a.useContext)(P)},B=n(28),F=Object(a.createContext)(),z=Object(a.createContext)(),J=function(e,t){var n,a,s,r=t.payload,c=r.username,o=r.message,i=r.messages,l=r.reaction;switch(t.type){case"SET_USERS":return Object(u.a)(Object(u.a)({},e),{},{users:t.payload});case"SET_USER_MESSAGES":return s=(a=Object(B.a)(e.users)).findIndex((function(e){return e.username===c})),a[s]=Object(u.a)(Object(u.a)({},a[s]),{},{messages:i}),Object(u.a)(Object(u.a)({},e),{},{users:a});case"SET_SELECTED_USER":return a=e.users.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{selected:e.username===t.payload})})),Object(u.a)(Object(u.a)({},e),{},{users:a});case"ADD_MESSAGE":s=(a=Object(B.a)(e.users)).findIndex((function(e){return e.username===c})),o.reactions=[];var j=Object(u.a)(Object(u.a)({},a[s]),{},{messages:a[s].messages?[o].concat(Object(B.a)(a[s].messages)):null,latestMessage:o});return a[s]=j,Object(u.a)(Object(u.a)({},e),{},{users:a});case"ADD_REACTION":s=(a=Object(B.a)(e.users)).findIndex((function(e){return e.username===c}));var d=Object(u.a)({},a[s]),b=null===(n=d.messages)||void 0===n?void 0:n.findIndex((function(e){return e.uuid===l.message.uuid}));if(b>-1){var O=Object(B.a)(d.messages),m=Object(B.a)(O[b].reactions),g=m.findIndex((function(e){return e.uuid===l.uuid}));g>-1?m[g]=l:m=[].concat(Object(B.a)(m),[l]),O[b]=Object(u.a)(Object(u.a)({},O[b]),{},{reactions:m}),d=Object(u.a)(Object(u.a)({},d),{},{messages:O}),a[s]=d}return Object(u.a)(Object(u.a)({},e),{},{users:a});default:throw new Error("Unknown action type: ".concat(t.type))}},H=function(e){var t=e.children,n=Object(a.useReducer)(J,{users:null}),s=Object($.a)(n,2),r=s[0],c=s[1];return Object(h.jsx)(z.Provider,{value:c,children:Object(h.jsx)(F.Provider,{value:r,children:t})})},K=function(){return Object(a.useContext)(F)},V=function(){return Object(a.useContext)(z)},W=n(144),X=n(145),Z=n(88),ee=n(6),te=n.n(ee),ne=Object(L.a)(G||(G=Object(E.a)(["\n  query getUsers {\n    getUsers {\n      username\n      createdAt\n      imageUrl\n      latestMessage {\n        uuid\n        from\n        to\n        content\n        createdAt\n      }\n    }\n  }\n"])));function ae(){var e,t,n=V(),a=K().users,s=null===a||void 0===a||null===(e=a.find((function(e){return!0===e.selected})))||void 0===e?void 0:e.username,r=Object(W.a)(ne,{onCompleted:function(e){return n({type:"SET_USERS",payload:e.getUsers})},onError:function(e){return console.log(e)}}).loading;return!a||r?t=Object(h.jsx)("p",{children:"Loading..."}):0===a.length?t=Object(h.jsx)("p",{children:"No users have joined yet"}):a.length>0&&(t=a.map((function(e){var t=s===e.username;return Object(h.jsxs)("div",{role:"button",className:te()("user-div d-flex justify-content-center justify-content-md-start p-3",{"bg-white":t}),onClick:function(){return n({type:"SET_SELECTED_USER",payload:e.username})},children:[Object(h.jsx)(X.a,{src:e.imageUrl||"https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y",className:"user-image"}),Object(h.jsxs)("div",{className:"d-none d-md-block ml-2",children:[Object(h.jsx)("p",{className:"text-success",children:e.username}),Object(h.jsx)("p",{className:"font-weight-light",children:e.latestMessage?e.latestMessage.content:"You are now connected!"})]})]},e.username)}))),Object(h.jsx)(Z.a,{xs:2,md:4,className:"p-0 bg-secondary",children:t})}var se,re,ce,oe=n(147),ie=n(155),le=n(151),ue=n(150),je=n(152),de=n(146),be=n(89),Oe=n.n(be),me=["\u2764\ufe0f","\ud83d\ude06","\ud83d\ude2f","\ud83d\ude22","\ud83d\ude21","\ud83d\udc4d","\ud83d\udc4e"],ge=Object(L.a)(se||(se=Object(E.a)(["\n  mutation reactToMessage($uuid: String!, $content: String!) {\n    reactToMessage(uuid: $uuid, content: $content) {\n      uuid\n    }\n  }\n"])));function xe(e){var t=e.message,n=Y().user,s=t.from===n.username,r=!s,c=Object(a.useState)(!1),o=Object($.a)(c,2),i=o[0],l=o[1],u=Object(B.a)(new Set(t.reactions.map((function(e){return e.content})))),j=Object(ie.a)(ge,{onError:function(e){return console.log(e)},onCompleted:function(e){return l(!1)}}),d=Object($.a)(j,1)[0],b=Object(h.jsx)(ue.a,{trigger:"click",placement:"top",show:i,onToggle:l,transition:!1,rootClose:!0,overlay:Object(h.jsx)(je.a,{className:"rounded-pill",children:Object(h.jsx)(je.a.Content,{className:"d-flex px-0 py-1 align-items-center react-btn-popover",children:me.map((function(e){return Object(h.jsx)(k.a,{className:"react-icon-btn",variant:"link",onClick:function(){return function(e){d({variables:{uuid:t.uuid,content:e}})}(e)},children:e},e)}))})}),children:Object(h.jsx)(k.a,{variant:"link",className:"px-2",children:Object(h.jsx)("i",{className:"far fa-smile"})})});return Object(h.jsxs)("div",{className:te()("d-flex my-3",{"ml-auto":s,"mr-auto":r}),children:[s&&b,Object(h.jsx)(ue.a,{placement:s?"right":"left",overlay:Object(h.jsx)(de.a,{children:Oe()(t.createdAt).format("MMMM DD, YYYY @ h:mm a")}),transition:!1,children:Object(h.jsxs)("div",{className:te()("py-2 px-3 rounded-pill position-relative",{"bg-primary":s,"bg-secondary":r}),children:[t.reactions.length>0&&Object(h.jsxs)("div",{className:"reactions-div p-1 rounded-pill",children:[u," ",t.reactions.length]}),Object(h.jsx)("p",{className:te()({"text-white":s}),children:t.content},t.uuid)]})}),r&&b]})}var pe,he,fe=Object(L.a)(re||(re=Object(E.a)(["\n  mutation sendMessage($to: String!, $content: String!){\n    sendMessage(to: $to, content: $content){\n      uuid from to content createdAt\n    }\n  }\n"]))),ve=Object(L.a)(ce||(ce=Object(E.a)(["\n  query getMessages($from: String!) {\n    getMessages(from: $from) {\n      uuid\n      from\n      to\n      content\n      createdAt\n      reactions{\n        uuid\n        content\n      }\n    }\n  }\n"])));function we(){var e=K().users,t=V(),n=Object(a.useState)(""),s=Object($.a)(n,2),r=s[0],c=s[1],o=null===e||void 0===e?void 0:e.find((function(e){return!0===e.selected})),i=null===o||void 0===o?void 0:o.messages,l=Object(oe.a)(ve),u=Object($.a)(l,2),j=u[0],d=u[1],b=d.loading,O=d.data,m=Object(ie.a)(fe,{onError:function(e){return console.log(e)}}),g=Object($.a)(m,1)[0];Object(a.useEffect)((function(){o&&!o.messages&&j({variables:{from:o.username}})}),[o]),Object(a.useEffect)((function(){O&&t({type:"SET_USER_MESSAGES",payload:{username:o.username,messages:O.getMessages}})}),[O]);var x,p=function(e){e.preventDefault(),""!==r.trim()&&o&&(g({variables:{to:o.username,content:r}}),c(""))};return i||b?b?x=Object(h.jsx)("p",{className:"info-text",children:"Loading..."}):i.length>0?x=i.map((function(e,t){return Object(h.jsxs)(a.Fragment,{children:[Object(h.jsx)(xe,{message:e}),t===i.length-1&&Object(h.jsx)("div",{className:"invisible",children:Object(h.jsx)("hr",{className:"m-0"})})]},i.uuid)})):0===i.length&&(x=Object(h.jsx)("p",{className:"info-text",children:"You are now connected! send your first message!"})):x=Object(h.jsx)("p",{className:"info-text",children:"Select a Friend"}),Object(h.jsxs)(Z.a,{xs:10,md:8,className:"p-0",children:[Object(h.jsx)("div",{className:"messages-box d-flex flex-column-reverse p-3",children:x}),Object(h.jsx)("div",{className:"px-3 py-2",children:Object(h.jsx)(le.a,{onSubmit:p,children:Object(h.jsxs)(le.a.Group,{className:"d-flex align-items-center m-0",children:[Object(h.jsx)(le.a.Control,{type:"text",className:"message-input rounded-pill p-4 bg-secondary border-0",placeholder:"Type a message ..",value:r,onChange:function(e){return c(e.target.value)}}),Object(h.jsx)("i",{className:"fas fa-paper-plane fa-2x text-primary ml-2",onClick:p,role:"button"})]})})})]})}var ye,Se=Object(L.a)(pe||(pe=Object(E.a)(["\n  subscription newMessage{\n    newMessage{\n      uuid \n      from \n      to \n      content \n      createdAt\n    }\n  }\n"]))),Ne=Object(L.a)(he||(he=Object(E.a)(["\n  subscription newReaction{\n    newReaction{\n      uuid \n      content\n      message{\n        uuid from to \n      }\n    }\n  }\n"])));function Ee(e){e.history;var t=Q(),n=V(),s=Y().user,r=Object(M.a)(Se),c=r.data,o=r.error,l=Object(M.a)(Ne),u=l.data,j=l.error;Object(a.useEffect)((function(){if(o&&console.log(o),c){var e=c.newMessage,t=s.username===e.to?e.from:e.to;n({type:"ADD_MESSAGE",payload:{username:t,message:e}})}}),[c,o]),Object(a.useEffect)((function(){if(j&&console.log(j),u){var e=u.newReaction,t=s.username===e.message.to?e.message.from:e.message.to;n({type:"ADD_REACTION",payload:{username:t,reaction:e}})}}),[u,j]);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)(C.a,{className:"bg-white justify-content-around mb-2",children:[Object(h.jsx)(i.b,{to:"/login",children:Object(h.jsx)(k.a,{variant:"link",children:"Login"})}),Object(h.jsx)(i.b,{to:"/register",children:Object(h.jsx)(k.a,{variant:"link",children:"register"})}),Object(h.jsx)(k.a,{variant:"link",onClick:function(){t({type:"LOGOUT"}),window.location.href="/login"},children:"LogOut"})]}),Object(h.jsxs)(C.a,{className:"bg-white",children:[Object(h.jsx)(ae,{}),Object(h.jsx)(we,{})]})]})}var Ce,ke=Object(L.a)(ye||(ye=Object(E.a)(["\n  query Login(\n    $username: String!\n    $password: String!\n  ) {\n    login(\n      username: $username\n      password: $password\n    ) {\n      username\n      email\n      createdAt\n      token\n    }\n  }\n"])));function Le(e){var t,n,s=Object(a.useState)({username:"",password:""}),r=Object($.a)(s,2),c=r[0],o=r[1],l=Object(a.useState)({}),j=Object($.a)(l,2),d=j[0],b=j[1],O=Q(),m=Object(oe.a)(ke,{onError:function(e){console.log(e.graphQLErrors[0].extensions.errors),b(e.graphQLErrors[0].extensions.errors)},onCompleted:function(e){O({type:"LOGIN",payload:e.login}),window.location.href="/"}}),g=Object($.a)(m,2),x=g[0],p=g[1],f=p.loading;p.data,p.error;return Object(h.jsx)(C.a,{className:"bg-white py-5 justify-content-center",children:Object(h.jsxs)(Z.a,{sm:8,md:6,lg:4,children:[Object(h.jsx)("h1",{className:"text-center",children:"Login"}),Object(h.jsxs)(le.a,{onSubmit:function(e){e.preventDefault(),x({variables:c})},children:[Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:d.username&&"text-danger",children:null!==(t=d.username)&&void 0!==t?t:"Username"}),Object(h.jsx)(le.a.Control,{className:d.username&&"is-invalid",type:"text",value:c.username,onChange:function(e){return o(Object(u.a)(Object(u.a)({},c),{},{username:e.target.value}))}})]}),Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:d.password&&"text-danger",children:null!==(n=d.password)&&void 0!==n?n:"Password"}),Object(h.jsx)(le.a.Control,{className:d.password&&"is-invalid",type:"password",value:c.password,onChange:function(e){return o(Object(u.a)(Object(u.a)({},c),{},{password:e.target.value}))}})]}),Object(h.jsxs)("div",{className:"text-center",children:[Object(h.jsx)(k.a,{variant:"success",type:"submit",disabled:f,children:f?"loading..":"Login"}),Object(h.jsx)("br",{}),Object(h.jsxs)("small",{children:["Don't have an account? ",Object(h.jsx)(i.b,{to:"/register",children:"Register"})]})]})]})]})})}var Me=Object(L.a)(Ce||(Ce=Object(E.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      username: $username\n      email: $email\n      password: $password\n      confirmPassword: $confirmPassword\n    ) {\n      username\n      email\n      createdAt\n    }\n  }\n"])));function $e(e){var t,n,s,r,c=Object(a.useState)({email:"",username:"",password:"",confirmPassword:""}),o=Object($.a)(c,2),l=o[0],j=o[1],d=Object(a.useState)({}),b=Object($.a)(d,2),O=b[0],m=b[1],g=Object(ie.a)(Me,{update:function(t,n){e.history.push("/login")},onError:function(e){console.log(e.graphQLErrors[0].extensions.errors),m(e.graphQLErrors[0].extensions.errors)}}),x=Object($.a)(g,2),p=x[0],f=x[1],v=f.loading;f.data,f.error;return Object(h.jsx)(C.a,{className:"bg-white py-5 justify-content-center",children:Object(h.jsxs)(Z.a,{sm:8,md:6,lg:4,children:[Object(h.jsx)("h1",{className:"text-center",children:"Register"}),Object(h.jsxs)(le.a,{onSubmit:function(e){e.preventDefault(),p({variables:l})},children:[Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:O.email&&"text-danger",children:null!==(t=O.email)&&void 0!==t?t:"Email address"}),Object(h.jsx)(le.a.Control,{className:O.email&&"is-invalid",type:"email",value:l.email,onChange:function(e){return j(Object(u.a)(Object(u.a)({},l),{},{email:e.target.value}))}})]}),Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:O.username&&"text-danger",children:null!==(n=O.username)&&void 0!==n?n:"Username"}),Object(h.jsx)(le.a.Control,{className:O.username&&"is-invalid",type:"text",value:l.username,onChange:function(e){return j(Object(u.a)(Object(u.a)({},l),{},{username:e.target.value}))}})]}),Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:O.password&&"text-danger",children:null!==(s=O.password)&&void 0!==s?s:"Password"}),Object(h.jsx)(le.a.Control,{className:O.password&&"is-invalid",type:"password",value:l.password,onChange:function(e){return j(Object(u.a)(Object(u.a)({},l),{},{password:e.target.value}))}})]}),Object(h.jsxs)(le.a.Group,{children:[Object(h.jsx)(le.a.Label,{className:O.confirmPassword&&"text-danger",children:null!==(r=O.confirmPassword)&&void 0!==r?r:"Confirm Password"}),Object(h.jsx)(le.a.Control,{className:O.confirmPassword&&"is-invalid",type:"password",value:l.confirmPassword,onChange:function(e){return j(Object(u.a)(Object(u.a)({},l),{},{confirmPassword:e.target.value}))}})]}),Object(h.jsxs)("div",{className:"text-center",children:[Object(h.jsx)(k.a,{variant:"success",type:"submit",disabled:v,children:v?"loading..":"Register"}),Object(h.jsx)("br",{}),Object(h.jsxs)("small",{children:["Already have an account? ",Object(h.jsx)(i.b,{to:"/login",children:"Login"})]})]})]})]})})}function Ae(e){var t=Y().user;return e.authenticated&&!t?Object(h.jsx)(l.a,{to:"/login"}):e.guest&&t?Object(h.jsx)(l.a,{to:"/"}):Object(h.jsx)(l.b,Object(u.a)({component:e.component},e))}var De=function(){return Object(h.jsx)(N,{children:Object(h.jsx)(q,{children:Object(h.jsx)(H,{children:Object(h.jsx)(i.a,{children:Object(h.jsx)(o.a,{className:"pt-5",children:Object(h.jsxs)(l.d,{children:[Object(h.jsx)(Ae,{exact:!0,path:"/",component:Ee,authenticated:!0}),Object(h.jsx)(Ae,{path:"/register",component:$e,guest:!0}),Object(h.jsx)(Ae,{path:"/login",component:Le,guest:!0})]})})})})})})};c.a.render(Object(h.jsx)(s.a.StrictMode,{children:Object(h.jsx)(De,{})}),document.getElementById("root"))}},[[128,1,2]]]);
//# sourceMappingURL=main.d72f4b36.chunk.js.map